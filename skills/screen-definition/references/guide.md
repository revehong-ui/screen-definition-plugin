# 화면정의서 오버레이 시스템 - 사용 가이드

## 이게 뭔가요?

프로토타입 화면 위에 **번호 뱃지 + 보더 하이라이트**를 표시하고, 우측 패널에서 각 컴포넌트의 기능 명세/정책/인터랙션/데이터 요구사항을 바로 확인할 수 있는 **기획자용 오버레이 도구**입니다.

```
┌─────────────────────────────────────────┬──────────────┐
│  프로토타입 화면                          │  화면정의서    │
│                                         │  패널         │
│  ┌─[1]──────────────┐                   │              │
│  │ 토픽 분석 위젯     │                   │ [1] 토픽 분석 │
│  └──────────────────┘                   │  Must-Have    │
│                                         │  1-1. 토픽 목록│
│  ┌─[2]──────────────┐                   │  1-2. 상세패널 │
│  │ 댓글 추이 차트     │                   │  1-3. 날짜 탭 │
│  └──────────────────┘                   │              │
│                                         │  [수정] [삭제]│
│  ← 항목 클릭 시 해당 컴포넌트로 이동 +     │  [공유]       │
│    펄스 하이라이트 효과                    │              │
└─────────────────────────────────────────┴──────────────┘
```

---

## 언제 사용하나요?

| 상황 | 설명 |
|------|------|
| 프로토타입 리뷰 | 기획자가 프로토타입의 각 영역 정의를 확인할 때 |
| 기획-개발 핸드오프 | 개발자에게 각 컴포넌트의 정확한 스펙을 전달할 때 |
| 기획 변경 관리 | 요구사항 수정 이력을 추적할 때 |
| 스펙 공유 | Markdown/JSON/GitHub Issue로 내보내서 공유할 때 |
| 상세 기능 정의 | 서브아이템(N-1, N-2)으로 내부 컴포넌트별 기능/정책 작성 |

---

## 호출 방법

### Claude Code에서 호출
```
/screen-definition
```

이 명령을 실행하면 Claude가 현재 프로젝트에 화면정의서 오버레이 시스템을 자동 구축합니다.

---

## 전제 조건

| 항목 | 요구사항 |
|------|----------|
| 프레임워크 | Next.js (App Router) 또는 순수 HTML/JS |
| 스타일 | Tailwind CSS 또는 CSS-in-JS (자동 주입) |
| 추가 패키지 | 없음 (기존 의존성만 사용) |

> 순수 HTML 프로토타입의 경우 단일 JS 파일(screen-definition.js)로 구축되며, localStorage 기반 영속화를 사용합니다.

---

## 구축 후 생성되는 파일

### Next.js 프로젝트
```
프로젝트/
├── types/screen-definition.ts
├── data/screen-definition-state.json
├── app/api/screen-definition/route.ts
├── components/
│   ├── ScreenDefinitionContext.tsx
│   ├── ScreenDefinitionLayout.tsx
│   ├── ScreenDefinitionPanel.tsx
│   └── NumberedOverlay.tsx
├── lib/
│   ├── screen-definition-data.ts
│   └── screen-definition-export.ts
```

### 순수 HTML/JS 프로젝트
```
프로젝트/
└── screen-definition.js    # 단일 IIFE 파일 (전체 시스템 포함)
```

---

## 사용법 (구축 후)

### 1. 기획 모드 ON/OFF

화면 좌하단의 **기획 모드 토글 버튼** (격자 아이콘)을 클릭하면:
- 번호 뱃지 + 보더 하이라이트 표시
- 우측에 화면정의서 패널 오픈

### 2. 섹션 확인 + 컴포넌트 이동

패널 리스트에서 항목을 클릭하면:
1. 해당 컴포넌트로 **자동 스크롤 이동** (scrollIntoView)
2. **펄스 하이라이트 애니메이션** (box-shadow 펄스 2회)
3. 패널에 상세 정보 표시

번호 뱃지를 클릭해도 동일하게 동작합니다.

| 탭 | 내용 |
|----|------|
| 기능/정책 | 설명, MoSCoW 우선순위, 정책 규칙, **서브 아이템** |
| 컴포넌트 | DOM 구성, 셀렉터, 스타일 스펙 |
| 인터랙션 | 트리거, 액션, 이벤트 타입 |
| 데이터 | 필요 데이터, 타입, 소스 |

### 3. 섹션 수정 (4탭 전체 편집)

패널 상세 뷰에서 **연필 아이콘** 클릭:

| 편집 탭 | 수정 가능 항목 |
|---------|---------------|
| 기능/정책 | 이름, 설명, 우선순위(MoSCoW), 정책 규칙 추가/삭제 |
| 컴포넌트 | 컴포넌트 목록 (이름/타입/스펙) 추가/삭제 |
| 인터랙션 | 인터랙션 목록 (트리거/액션/타입) 추가/삭제 |
| 데이터 | 데이터 요구사항 (필드/타입/소스) 추가/삭제 |

- 탭 전환 시 편집 내용 자동 보존 (임시 저장)
- **저장** 클릭 시 모든 탭 변경사항 일괄 반영 + 히스토리 기록
- **취소** 클릭 시 모든 변경 폐기

### 4. 서브 아이템 (N-1, N-2 형식)

서브 아이템에 **셀렉터**(CSS 셀렉터)가 설정되어 있으면, 기획 모드에서 프로토타입 화면의 해당 요소에 **서브아이템 번호 뱃지**(1-1, 1-2, ...)와 **점선 보더**가 자동으로 표시됩니다.

```
┌─[1]──────────────────────────────────────────┐
│ 토픽 분석 위젯                                │
│   ┌─[1-1]──────────┐ ┌─[1-2]──────────────┐ │
│   │ .topic-list     │ │ .topic-detail       │ │
│   │ (토픽 목록)      │ │ (상세 패널)          │ │
│   └────────────────┘ └────────────────────┘ │
│   ┌─[1-3]──────────────────────────────────┐ │
│   │ .tab-container (날짜 탭)                 │ │
│   └────────────────────────────────────────┘ │
└──────────────────────────────────────────────┘
```

기능/정책 탭 하단에서 각 섹션의 내부 컴포넌트별 상세 기능/정책을 관리합니다:

```
[1] 토픽 분석 위젯
  1-1. 토픽 목록 테이블 [기능] — 뉴스 토픽을 기사수 기준...
  1-2. 토픽 상세 패널 [기능] — 선택된 토픽의 대표 기사...
  1-3. 날짜 탭 전환 [기능] — 어제/오늘 2개 탭...
  1-4. 기사 링크 외부 이동 [기능] — 기사 제목 클릭 시...
  1-5. 초기 로드 정책 [정책] — 위젯 로드 시 오늘 탭...
  1-6. 데이터 구조 정책 [정책] — SOMETREND_DATA 참조...
```

**서브 아이템 관리:**
- **추가**: "서브 아이템 추가" 버튼 → 이름/유형(기능·정책)/설명 입력
- **화면에서 선택**: "화면에서 선택" 버튼 → 프로토타입에서 직접 컴포넌트 클릭 → 이름 자동 생성 → 서브아이템 추가 폼 오픈
- **편집**: 연필 아이콘 → 인라인 편집 폼
- **삭제**: 휴지통 아이콘 → 즉시 삭제 (히스토리에 기록, Undo 가능)

### 4-1. 화면에서 컴포넌트 선택하여 서브 아이템 추가

기능/정책 탭 하단의 **"화면에서 선택"** 버튼을 클릭하면:

1. 화면이 **선택 모드**로 전환 (커서가 십자 모양으로 변경)
2. 프로토타입 화면의 요소 위에 hover하면 **빨간 점선 아웃라인** 표시
3. 패널 상단에 **"화면에서 컴포넌트를 클릭하세요"** 배너 표시
4. 원하는 컴포넌트를 **클릭**하면:
   - 클릭된 요소의 클래스명/태그 + 텍스트로 **이름 자동 생성**
   - 서브 아이템 추가 폼이 열리며 이름이 **자동 입력** (프리필)
   - 유형/설명을 입력 후 **추가** 버튼으로 저장
5. **취소** 버튼으로 선택 모드를 종료할 수 있습니다

### 5. 섹션 삭제

패널 상세 뷰에서 **휴지통 아이콘** 클릭:
- 1차 클릭: "삭제?" 확인 표시 (3초 내 미확인 시 해제)
- 2차 클릭: 실제 삭제 (히스토리에 기록, Undo 가능)

### 6. 되돌리기 (Undo)

패널 헤더의 **시계 아이콘** 클릭:
- 수정/삭제 이력 목록 확인
- 각 항목의 **Undo** 버튼으로 이전 상태 복원

### 7. 텍스트 개행

설명, 정책, 컴포넌트 스펙, 서브아이템 설명 등 모든 텍스트 필드에서 **줄바꿈(Enter)**이 지원됩니다.

```
편집 모드에서:
  textarea에 여러 줄 입력 → 저장 → 패널에서 줄바꿈 그대로 표시

내보내기에서:
  Markdown 테이블 셀 → \n이 <br>로 자동 변환
  GitHub Issue 리스트 → \n이 공백으로 치환 (한 줄 유지)
  JSON → \n 원본 보존
```

### 8. 공유 (Share)

패널 상세 뷰에서 **Share 드롭다운**:
- **Copy as Markdown**: 서브아이템 포함 마크다운 복사
- **Copy as JSON**: 전체 데이터 JSON 복사
- **Download .md**: 마크다운 파일 다운로드
- **GitHub Issue 복사**: 서브아이템별 체크리스트 포함 이슈 내용 복사

---

## 프로토타입에 섹션 추가하기

프로토타입의 HTML 요소에 `data-sd-id` 속성을 추가하면 자동으로 오버레이에 표시됩니다:

```html
<header data-sd-id="SEC-GL-02">...</header>
<div data-sd-id="SEC-DB-01" class="kpi-cards">...</div>
```

그리고 섹션 데이터 (DEFAULTS 배열 또는 screen-definition-data.ts)에 해당 ID의 데이터를 추가합니다.

### 섹션 ID 네이밍 규칙

```
SEC-{카테고리}-{번호}

카테고리:
  GL = Global Layout      SR = Search
  DB = Dashboard          MT = Mention Trend
  CH = Channel            SA = Sentiment Analysis
  SK = Sentiment Keyword  DA = Deep Analysis
  RK = Related Keyword    IF = Influencer
  HI = Hot Issue          RP = Report
  CP = Compare            NW = Network
  CM = Community          DT = Data Table
  SB = Sidebar            HD = Header
  CT = Chat Content       IN = Input
  FT = Footer
```

---

## 팀 역할별 활용

| 역할 | 활용 방법 |
|------|----------|
| **기획자** | 섹션 정의 + 서브아이템 작성, 정책 관리, 우선순위 설정 |
| **디자이너** | 컴포넌트 스펙 확인, 인터랙션 정의 참조 |
| **퍼블리셔** | `data-sd-id` 속성 추가, 마크업 구조 참조 |
| **프론트엔드** | 인터랙션/데이터 요구사항 참조, 서브아이템으로 구현 체크리스트 |
| **백엔드** | 데이터 탭에서 필요 데이터/API 스펙 확인 |
| **PM** | MoSCoW 우선순위로 스프린트 계획, 히스토리로 변경 추적 |

---

## MoSCoW 우선순위

| 등급 | 의미 | 색상 |
|------|------|------|
| **Must** | 반드시 구현 | 빨강 |
| **Should** | 가능하면 구현 | 주황 |
| **Could** | 있으면 좋음 | 초록 |
| **Won't** | 이번에는 제외 | 회색 |

---

## 데이터 영속화 흐름

### Next.js
```
[수정/삭제] → Context 상태 변경 → 500ms 디바운스
    → PUT /api/screen-definition → data/screen-definition-state.json
    → git commit → 팀원과 동일 상태 공유
```

### 순수 HTML/JS
```
[수정/삭제] → 상태 변경 → 500ms 디바운스
    → localStorage.setItem('sd-state', JSON.stringify(...))
    → 새로고침 후에도 유지
```

---

## 주의사항

- localStorage에 이전 버전 데이터가 있으면 새 필드(subItems 등)는 DEFAULTS에서 자동 마이그레이션됩니다
- 완전 초기화가 필요하면 브라우저 DevTools에서 `localStorage.removeItem('sd-state')` 실행
- MutationObserver는 콘텐츠 컨테이너만 관찰합니다 (body 전체 관찰 시 무한루프 발생)
